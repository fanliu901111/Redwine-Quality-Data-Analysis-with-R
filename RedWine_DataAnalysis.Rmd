---
output:
  html_document: default
  pdf_document: default
---
```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```


# Red Wine Data Anlaysis by Fan Liu
## About
In this project, I will explore a data set on red wine quality and physicochemical properties. The objective is to explore which chemical properties influence the quality of red wines. This dataset is public available for research.

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Reading the file
rw <- read.csv('wineQualityReds.csv')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Loading all packages
library(ggplot2)
library(gridExtra)
library(GGally)
library(scales)
library(reshape)
```

### Summary of data
Let's check the basic information for the statistics
```{r echo=FALSE, message=FALSE, warning=FALSE}
head(rw)
str(rw)
summary(rw)
```

By scanning the summary of dataset, we can see that all the explanlotory variables are numerical, and the only response variable is integer. 
This report explores a dataset containing quality and attributes for approximately 15,999 observations.

##Univariate Plots Section

Checking the main response variable's distribution
```{r echo=FALSE, message=FALSE, warning=FALSE}
g_quality <-
  ggplot(aes(x=as.factor(rw$quality)),data=rw)+
  xlab("quality")+
  geom_bar(fill = "#CC79A7" ,color="#000000")

g_quality
```

By observing the distribution of "quality" we can see it is approximately normal distribution, and there are no obvious outliers.

## Add Another Feature
Arrange the quality into three groups: bad,average,good.

* bad: quality scale (0 to 5)
* average: quality scale (6 to 7)
* good : quality scale (8 to 10)

```{r}
#Adding another feature
rw$rating <- ifelse(rw$quality < 5, 'bad', ifelse(
  rw$quality < 7, 'average', 'good'))
rw$rating <- ordered(rw$rating,
                     levels = c('bad', 'average', 'good'))

g_rating <- ggplot(aes(x=rw$rating),data=rw)+
              geom_bar(fill= "#CC79A7")
g_rating
```

By observing the boxplots, we can tell that most of wine are falling into the "average" category.

Checking other variables' distribution

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Bar chart of the count of chemical propoerties
g1<-
  ggplot(aes(x=rw$fixed.acidity),data=rw)+
  xlab("fixed acidity")+
  geom_histogram(colour="#000000",fill="#CC79A7")

g2<-
  ggplot(aes(x=rw$volatile.acidity),data=rw)+
  xlab("Volatile acidity")+
  geom_histogram(colour="#000000",fill="#CC79A7")

g3<-
  ggplot(aes(x=rw$citric.acid),data=rw)+
  xlab("Critic acid")+
  geom_histogram(colour="#000000",fill="#CC79A7")

g4<-
  ggplot(aes(x=rw$residual.sugar),data=rw)+
  xlab("Residual sugar")+
  geom_histogram(colour="#000000",fill="#CC79A7")

g5<-
  ggplot(aes(x=rw$chlorides),data=rw)+
  xlab("Chlorides")+
  geom_histogram(colour="#000000",fill="#CC79A7")

g6<-
  ggplot(aes(x=rw$free.sulfur.dioxide),data=rw)+
  xlab("Free sulfur dioxide")+
  geom_histogram(colour="#000000",fill="#CC79A7")

g7<-
  ggplot(aes(x=rw$total.sulfur.dioxide),data=rw)+
  xlab("Total sulfur dioxide")+
  geom_histogram(colour="#000000",fill="#CC79A7")

g8<-
  ggplot(aes(x=rw$density),data=rw)+
  xlab("Density")+
  geom_histogram(colour="#000000",fill="#CC79A7")
  
g9<-
  ggplot(aes(x=rw$pH),data=rw)+
  xlab("pH")+
  geom_histogram(colour="#000000",fill="#CC79A7")

g10<-
  ggplot(aes(x=rw$sulphates),data=rw)+
  xlab("Sulphates")+
  geom_histogram(colour="#000000",fill="#CC79A7")

g11<-
  ggplot(aes(x=rw$alcohol),data=rw)+
  xlab("Alcohol")+
  geom_histogram(colour="#000000",fill="#CC79A7")


grid.arrange(g1,g2,g3,g4,g5,g6,g7,g8,g9,g10,g11,ncol=4)

```

### Find outliers
The graphs above show the distributions of each explanatory variable:

* Variables "fixed.acidity", "Volatile.acidity", "Density", and "pH" are approximate  
  normally distributed.
* Variables "Residual sugar","Free sulfur dioxide","Total sulfur dioxide","Sulphates" and
  "Alcohol" is right skewed.
* Variables "Critic.acid",and"Chlorides" are hard to tell distributions.

There should be outliers in some of the variables, hence let's check out the outliers.
```{r echo=FALSE, message=FALSE, warning=FALSE}
outlier_total <- boxplot.stats(rw$total.sulfur.dioxide)$out
outlier_sulphates <- boxplot.stats(rw$sulphates)$out
outlier_alcohol <- boxplot.stats(rw$alcohol)$out
outlier_citric <- boxplot.stats(rw$citric.acid)$out
outlier_residual <- boxplot.stats(rw$residual.sugar)$out
outlier_chlorides <- boxplot.stats(rw$chlorides)$out
outlier_free <- boxplot.stats(rw$free.sulfur.dioxide)$out
```

Variable | Number of outliers
------------- | -------------
total.sulfur.dioxide | 55
sulphates | 59
alcohol | 13
citric.acid | 1
residual.sugar | 155
chlorides | 112
free.sulfur.dioxide | 30


The table above shows that "residual.sugar"" and "chlorides" have significance amout of outliers.What's more,since some of the variables are higly skewed based on the histograms. Hence, log_scales need to be done when plotting.

### Rescale variables
```{r echo=FALSE, message=FALSE, warning=FALSE}
g.residual <- ggplot(data = rw,
       aes(x = residual.sugar)) +
  geom_histogram(colour="#000000",fill="#CC79A7") +
  scale_x_log10()

g.fixed <- ggplot(data = rw,
       aes(x = fixed.acidity)) +
  geom_histogram(colour="#000000",fill="#CC79A7") +
  scale_x_log10()

g.free <- ggplot(data = rw,
       aes(x = free.sulfur.dioxide)) +
  geom_histogram(colour="#000000",fill="#CC79A7") +
  scale_x_log10()

g.total <- ggplot(data = rw,
        aes(x=total.sulfur.dioxide))+
   geom_histogram(colour="#000000",fill="#CC79A7") +
  scale_x_log10()

g.sulphates <- ggplot(data = rw,
        aes(x=sulphates))+
   geom_histogram(colour="#000000",fill="#CC79A7") +
  scale_x_log10()

g.salcohol <- ggplot(data = rw,
        aes(x=alcohol))+
   geom_histogram(colour="#000000",fill="#CC79A7") +
  scale_x_log10()

grid.arrange(g.residual,g.fixed,g.free,g.total,g.sulphates,g.salcohol,ncol=2)
```

Compare to the formal histograms, graphs after rescale_x seem to approximately normally distributed.

## Univarite Plot Analysis
#### What is the structure of your dataset?
There are 1599 observations in the dataset with 13 features:

Input variables:

* X
* fixed acidity (tartaric acid - g / dm^3)
* volatile acidity (acetic acid - g / dm^3)
* citric acid (g / dm^3)
* residual sugar (g / dm^3)
* chlorides (sodium chloride - g / dm^3)
* free sulfur dioxide (mg / dm^3)
* total sulfur dioxide (mg / dm^3)
* density (g / cm^3)
* pH
* sulphates (potassium sulphate - g / dm3)
* alcohol (% by volume)

Output variable (based on sensory data): 

* quality (score between 0 and 10). 


#### What is/are the main feature(s) of interest in your dataset?

The main feature in the dataset is quality. I’d like to determine which features have stronger influences on red wine quality.

#### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

I think the features like pH, density, citric.acid, volatile.acid and sulphates would help support my investigation, because I think the quality of the red wine is highly related to those variables.

#### Did you create any new variables from existing variables in the dataset?

Yes, I create the rating variable based on the wine quality.

#### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

Yes, there were some unusual distributions. I did the scale_x_log10 to them. After I did the transformation, those variables are becoming from right skewed data to the approximately normal distribution.




## Bivariate Plots Section
Let's find the correlations between quality and other 11 varibales.
First, let's investigate the correlation between each varibale.

```{r}
ggcorr(rw)
```

By obseving the graph above, we can have the following 



### A table that contains correlation between quality and other 11 variables
Variables | Correlation Value
------------- | -------------
Fixed acidity | 0.124
Volatile acidity | -0.391
Citric.acidity | 0.226
Residual sugar | 0.024
Chlorides     | -0.176
Free sulfur dioxide| -0.050
Total sulfur dioxide | -0.170
Dencity |-0.175
pH      | -0.058
Sulphates | 0.309
Alcohol | 0.477


## Bivarite Plot Analysis

We can see that correlations of "Volatitle acidity", "Citric.acidity","Sulphates",and "Alcohol" are bigger than 0.2 or -0.2, which indicate that these four varibales have more influences on "quality". However, correlation between "citric.acidity" and "Volatitle.acidity" has a relatively strong negative correlation, so it is multicollinearity, then we want to use only one of the variable to do the prediction. In here, I will choose Volatitle.acidity.

#### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

* By observing these graphs, we can see that the higher the alcohol content, the greater the wine quality.
* It is the same for citric.acid and sulphates. They all have the posotive correlation with wine quality.
* However, volatile acidity has a negetive correlation with wine quality.
* Fixed.acidity seems to have little to no effect on quality

#### What was the strongest relationship you found?
The strongest relationship is between Sulphates and wine quality.



## Multivariate Plots Section

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = rw,
       aes(x = citric.acid, y = volatile.acidity,
           color = as.factor(quality))) +
  geom_point() +
  facet_wrap(~rating)

ggplot(data = rw,
       aes(x = alcohol, y = sulphates,
           color = as.factor(quality))) +
  geom_point() +
  facet_wrap(~rating)

ggplot(data = rw,
       aes(x = pH, y = alcohol, 
           color = as.factor(quality))) +
  geom_point() +
  facet_wrap(~rating)

```

* The relationship between alchohol and volatitle acidity are not strong, but we can see that a wine with a lower density of alcohol and lower volatitle acidity have a better quality.
* And also, It is clear that a higher citric acid and lower volatile (acetic) acid contributes towards better wines. 
* The relationship between sulphate and volatitle acidity seems like a negetive relaship.
* If we look at the relationship between sulphate and citric acid, there is a light positive relation between them. 
* And also a wine with a higher sulphate and a middle high citric acid tends to have a btter quality.

## Multivariate Analysis

#### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

By observing the multivariate plots we can see that, among the other features, there are not strong correlations.

But we can have the following observations:
* The higher the ctric acid with a lower volatile turns out to be a better quality of wine.
* Alcohol and sulphates do not have any relations.
* High alcohol contents and high sulphate concentrations combined seem to produce better wines.


#### Were there any interesting or surprising interactions between features?
I am actually surprise that there is a negative relation between sulphate and volatile.acidity.

## Final Plots and Summary
#### Plot one: Effects of alcohol on wine quality
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = rw, aes(x = as.factor(quality), y = rw$alcohol,
                      fill=rating)) +
  geom_boxplot() +
  ggtitle('Alcohol Levels in Different Wine Qualities') +
  xlab('Quality') +
  ylab('Alcohol')
```

By observing the graph above, we can see that a highrt alcohol density tends to make a better wine.

#### Plot two： Effects of sulphates and alcohol on wine quality
```{r}
ggplot(data = rw,
       aes(x = alcohol,y = sulphates,
           color = as.factor(quality))) +
  geom_point() +
  scale_x_log10() +
  ylab("Sulphates") +
  xlab("Alcohol") +
  ggtitle("Alcohol and sulphates over wine quality")
```
The chart above shows that a wine with a higher alcohol dencity and a lower sulphates tends to have a better quality.

#### Plot three: 
```{r}
ggplot(data = subset(rw, rating != 'average'),
       aes(x = volatile.acidity, y = alcohol,
                      color = as.factor(rating))) +
  geom_point() +
  ggtitle('Alcohol vs. Volatile Acidity and Wine Quality') +
  xlab('Volatile Acidity') +
  ylab('Alcohol')
```

As the correlation tests show, wine quality was affected most strongly by alcohol and volaticle acidity. 

## Reflection
Through this exploratory, I found that there are four main features would influence the wine quality.
They are: alcohol, sulphates, volatile acidity and citric acid. Among these four main features, alcohol concentration, sulphates and citric acidity are all have the positive correlation with wine quality. Volatile acidity has the negative relation with wine quality.
By looking at the univarite plots, we can see that some of the variables are right skewed or with long tails. Then I make the log-transformation.
The graphs adequately illustrate the factors that make good wines 'good' and bad wines 'bad'. 

By finishing this graph, I encounter the problems of definying outliers. However, used google to figure it out.I used scale when I was doing ploting, but use the original data to do the analysis.




















